var e=Object.defineProperty,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,s=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,o=(e,t,r)=>new Promise(((a,s)=>{var o=e=>{try{c(r.next(e))}catch(t){s(t)}},i=e=>{try{c(r.throw(e))}catch(t){s(t)}},c=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,i);c((r=r.apply(e,t)).next())}));import{e as i}from"./BasicForm.dbc54f8f.js";import{u as c}from"./useForm.a1fbfd4e.js";import{a as d}from"./role.data.3b92f357.js";import{_ as l,a as n}from"./useDrawer.cc3f9790.js";import{_ as u}from"./Tree.vue_vue&type=style&index=0&lang.63620210.js";import{l as m,a as p,S as f}from"./Role.8de26f50.js";import{k as h,aV as y,r as j,f as b,u as v,F as k,L as x,o as g,q as w,R as D,s as S,W as F,ai as K,Z as O,x as R,Y as B,O as I}from"./vendor.c2cc062a.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./index.9345068b.js";import"./CountdownInput.de5ce37b.js";/* empty css              */import"./useModal.1e927a40.js";import"./useWindowSizeFn.f7fa6c6d.js";/* empty css              */import"./uuid.2b29000c.js";import"./download.5e18ee04.js";import"./StrengthMeter.d3194e4f.js";/* empty css              */import"./useContextMenu.9ea7694e.js";import"./useExpose.9766eb76.js";var U=h({name:"RoleDrawer",components:{BasicDrawer:l,BasicForm:i,BasicTree:u,Checkbox:y},emits:["success","register"],setup(e,{emit:i}){const l=j(!0),u=j([]),h=j([]),y=j([]),x=j([]),g=j([]);let w=[],D="";const[S,{resetFields:F,setFieldsValue:K,validate:O}]=c({labelWidth:90,schemas:d,showActionButtonGroup:!1}),[R,{setDrawerProps:B,closeDrawer:I}]=n((e=>o(this,null,(function*(){F(),B({confirmLoading:!1}),l.value=!!(null==e?void 0:e.isUpdate),v(l)&&K(((e,o)=>{for(var i in o||(o={}))r.call(o,i)&&s(e,i,o[i]);if(t)for(var i of t(o))a.call(o,i)&&s(e,i,o[i]);return e})({},e.record)),D=e.record.id;let o=yield p();u.value=JSON.parse(o)})))),U=b((()=>v(l)?"编辑角色权限":"新增角色权限"));return k(h,(()=>o(this,null,(function*(){if(h.value[0]){let e=[];x.value.forEach((t=>{t.menu_ID==h.value[0]&&e.push({id:t.id,text:t.text,checked:t.checked})}));let t=yield m({roleId:D,menuId:h.value[0]});g.value=[],(null==t?void 0:t.length)&&(g.value=t,g.value.forEach((e=>{w.length&&w.includes(e.id)?e.checked=!0:e.checked&&w.push(e.id)})))}})))),{registerDrawer:R,registerForm:S,getTitle:U,handleSubmit:function(){return o(this,null,(function*(){try{const e=yield O();B({confirmLoading:!0});let t={id:e.id,functionIds:w.length?w.join():""};yield f(t),w=[],I(),i("success")}finally{B({confirmLoading:!1})}}))},treeData:u,selectedKeys:h,checkedKeys:y,ruleDataSource:g,ruleSource:x,changeRuleDataSource:function(e){e.checked?(w.push(e.id),x.value.forEach((t=>{t.id==e.id&&(t.checked=!0)}))):(x.value.forEach((t=>{t.id==e.id&&(t.checked=!1)})),w.splice(w.findIndex((t=>t===e.id)),1)),w=Array.from(new Set(w))}}}});const _={class:"flex items-start justify-between"},E={key:0,class:"pt-12 pl-2 w-32 border-l h-full"};U.render=function(e,t){const r=x("BasicTree"),a=x("checkbox"),s=x("BasicForm"),o=x("BasicDrawer");return g(),w(o,I(e.$attrs,{onRegister:e.registerDrawer,showFooter:"",title:e.getTitle,width:"600px",onOk:e.handleSubmit}),{default:D((()=>[S(s,{onRegister:e.registerForm},{menu:D((({model:s,field:o})=>[S("div",_,[S(r,{class:"flex-1",value:s[o],"onUpdate:value":e=>s[o]=e,checkedKeys:e.checkedKeys,"onUpdate:checkedKeys":t[1]||(t[1]=t=>e.checkedKeys=t),treeData:e.treeData,replaceFields:{title:"title",key:"key"},selectedKeys:e.selectedKeys,"onUpdate:selectedKeys":t[2]||(t[2]=t=>e.selectedKeys=t),toolbar:"",title:"菜单分配"},null,8,["value","onUpdate:value","checkedKeys","treeData","selectedKeys"]),e.ruleDataSource.length?(g(),w("div",E,[(g(!0),w(F,null,K(e.ruleDataSource,((t,r)=>(g(),w(a,{class:"m-0",key:r,onChange:r=>e.changeRuleDataSource(t),checked:t.checked,"onUpdate:checked":e=>t.checked=e},{default:D((()=>[O(R(t.funcName),1)])),_:2},1032,["onChange","checked","onUpdate:checked"])))),128))])):B("",!0)])])),_:1},8,["onRegister"])])),_:1},16,["onRegister","title","onOk"])};export default U;
